---
title: "Plugins in Rust: Working on Performance"
description: "Getting our plugin system ready for deployment"
author: "Mario Ortiz Manero"
tags: ["rust", "rustlang", "plugin", "bench", "benchmarking"]
series: ["rust-plugins"]
date: 2021-11-09
GHissueID: TODO
---

:sectnums:
:stem: latexmath

:repr-c: pass:quotes[`#[repr\(C)]`]
:work: pass:quotes["`just make it work`"]

////
I even hit a bug in the compiler, which made me feel oddly proud:

(include image)

It's seemingly related to incremental compilation and already reported:

https://github.com/rust-lang/rust/issues/90608
////

== Benchmarking process

Benchmarking procedure

Important:

* Make sure everything heavy is closed: discord, firefox, neovim + lsp, etc
* Histograms: https://hdrhistogram.github.io/HdrHistogram/plotFiles.html

.benchmark
[source]
----
cd tremor-cli/tests/bench/passthrough
export TREMOR_PATH=../../../../tremor-script/lib:../../lib/
../../../../target/release/tremor test bench . > ~/Programming/nullderef.com/content/blog/plugin-bench/results/NAME.hgrm
----

.or for flamegraph
[source]
----
flamegraph ../../../../target/release/tremor test bench . > ~/Programming/nullderef.com/content/blog/plugin-bench/results/NAME.hgrm
----

== Results

* Throughput was reduced 35% initially
* Latency had also been affected considerably at every percentile (TODO insert
  histogram here)
* According to the flamegraph 7% of the execution time was just conversions
  between regular and PDK types.

[bibliography]
== References

- [[[empty,      1]]] http://google.com
